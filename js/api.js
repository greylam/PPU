

!function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n={}.hasOwnProperty,o=function(a,b){function c(){this.constructor=a}for(var d in b)n.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a=jQuery,a(document).foundation(),ZeroClipboard.setDefaults({moviePath:"/static/classic/swf/ZeroClipboard.swf"}),e=e||{},e.Models=e.Models||{},e.Collections=e.Collections||{},e.Views=e.Views||{},e.Config=e.Config||{},e.Config.CSRFToken=a('meta[name="csrftoken"]').attr("content"),a.ajaxSetup({crossDomain:!1,beforeSend:function(a,b){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(b.type)?void 0:a.setRequestHeader("X-CSRFToken",e.Config.CSRFToken)}}),e.Model=function(a){function b(){return g=b.__super__.constructor.apply(this,arguments)}return o(b,a),b.prototype.url=function(){var a;return a=b.__super__.url.call(this),a+("/"===a.charAt(a.length-1)?"":"/")},b}(Backbone.Model),f=window.toastr,d=function(){function a(){}return a.prototype.contructor=function(){return f.options={debug:!1,positionClass:"toast-top-right",onclick:null,fadeIn:300,fadeOut:1e3,timeOut:5e3,extendedTimeOut:1e3}},a.prototype.success=function(a,b){return f.success(a,b)},a.prototype.info=function(a,b){return f.info(a,b)},a.prototype.warning=function(a,b){return f.warning(a,b)},a.prototype.error=function(a,b){return f.error(a,b)},a.prototype.clear=function(){return f.clear()},a}(),e.Notification=e.Notification||new d,a=jQuery,c=function(){function b(){this.prefix="form",this.dropdown_content="#add-new-material-dropdown-content",this.dropdown_content_link=this.dropdown_content+" li",this.dropdown="form .add-new-material-dropdown",this.dropdown_link=this.dropdown+" a.dropdown",this.list="ul#items",a(this.dropdown).length&&(this.enable(),this.update())}return b.prototype.enable=function(b){var c=this;return null==b&&(b=a("body")),b.on("click",this.dropdown_link,function(b){return a(c.dropdown_content).data("index",a(b.target).data("index"))}),b.on("click",this.dropdown_content_link,function(b){var d,e;return Foundation.libs.dropdown.close(a(c.dropdown_content)),d=a(c.dropdown_content).data("index"),e=a(b.target).data("content-name"),c.insert(d,e),b.stopPropagation(),!1}),a("form textarea").each(function(a,b){return c.enableEditor(b)}),a("form div.item").each(function(b,d){return c.enableRemoveButton(a(d)),c.enablePreviewButton(a(d))}),a("#items").sortable({axis:"y",handle:".rearrange-step",deactivate:function(){return c.hideHistory(),c.update()}}),a("#preview i.icon-remove").on("click",function(b){return b.stopPropagation(),a("#preview").foundation("reveal","close")})},b.prototype.enableEditor=function(b){return CodeMirror.fromTextArea(b,{viewportMargin:1/0,lineWrapping:!0,mode:a(b).hasClass("python-source")?"python":"markdown",lineNumbers:!0,theme:"default",indentUnit:4,extraKeys:{Enter:"newlineAndIndentContinueMarkdownList",Tab:function(a){var b;return a.somethingSelected()?a.indentSelection("add"):(b=Array(a.getOption("indentUnit")+1).join(" "),a.replaceSelection(b,"end","+input"))}}})},b.prototype.enableRemoveButton=function(b){var c,d=this;return c=b.find("i.icon-remove"),c.on("click",function(b){var e,f;return e=a(b.target).parents("li"),f=c.data("index"),confirm("Are you sure you want to delete this item?")?(d.slideField(e,"pk",f).val()?(d.slideField(e,"is_deleted",f).val("true"),e.hide()):e.remove(),d.hideHistory(),d.update()):void 0})},b.prototype.enablePreviewButton=function(b){var c,d=this;return c=b.find("i.icon-eye"),c.on("click",function(b){var e,f,g;return e=a(b.target).parents("li"),g=c.data("index"),e.find(".CodeMirror").each(function(a,b){return b.CodeMirror.save()}),f=StepicParser.parse(d.contentField(e,"content",g).val()),a("#preview .slide-view").html(f),MathJax.Hub.Queue(["Typeset",MathJax.Hub,a("#preview .slide-view")[0]]),a("#preview").foundation("reveal","open")})},b.prototype.insert=function(b,c){var d,e,f,g,h,i,j=this;return i=a("#empty-slide").children().clone(),d=a("#empty-"+c).children().clone(),e=a(this.dropdown+":first").clone(),g=a(this.list),i&&d&&e?(h=a("<div/>",{"class":"item"}).append(i,d,a("<i/>",{"class":"icon-eye"}),a("<i/>",{"class":"icon-remove"})),f=a("<li/>").append(h,e),g.children("li").length?b?g.children("li:eq("+(b-1)+")").after(f):g.children("li:first").before(f):f.appendTo(g),d.find("textarea").each(function(a,b){return j.enableEditor(b)}),this.enableRemoveButton(h),this.enablePreviewButton(h),this.slideField(h,"content_name","empty").val(c),this.hideHistory(),this.update(),h):void 0},b.prototype.rename=function(b,c){var d,e,f,g,h;for(g=["name","id","for"],h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(b.find("["+d+"]").each(function(b,e){return a(e).attr(d,a(e).attr(d).replace(/slide-[^-]+/,"slide-"+c)),a(e).attr(d,a(e).attr(d).replace(/content-[^-]+/,"content-"+c))}));return h},b.prototype.hideHistory=function(){return a(".history-material-dropdown").hide()},b.prototype.update=function(){var b,c,d,e=this;return b=a("form .item"),c=b.length,this.formField("count").val(c),d=0,b.each(function(b,c){var f,g,h;return a(c).is(":visible")&&(d+=1),e.rename(a(c),b),e.slideField(a(c),"position",b).val(d),f=a(c).find("legend"),h=f.text(),/^\[\s*\d+\s*\]/.test(h)?f.text(h.replace(/^\[\s*\d+\s*\]/,"[ "+d+" ]")):f.text("[ "+d+" ] "+h),g=e.slideField(a(c),"status",b).val().toLowerCase(),"error"===g&&a(c).addClass("status-error"),"preparing"===g?a(c).addClass("status-preparing"):void 0}),a("form div.item").each(function(b,c){return a(c).data("index",b),a(c).find("i.icon-remove").data("index",b),a(c).find("i.icon-eye").data("index",b)}),a(this.dropdown_link).each(function(b,c){return a(c).data("index",b)})},b.prototype.formField=function(b){var c;return c=[this.prefix,b].join("-"),a("form").find('[name="'+c+'"]')},b.prototype.slideField=function(a,b,c){var d;return d=[this.prefix,"slide",c,b].join("-"),a.find('[name="'+d+'"]')},b.prototype.contentField=function(a,b,c){var d;return d=[this.prefix,"content",c,b].join("-"),a.find('[name="'+d+'"]')},b}(),a(function(){return new c}),e.Models.AttachmentItem=function(a){function b(){return h=b.__super__.constructor.apply(this,arguments)}return o(b,a),b.prototype.defaults={name:null,file:null},b.prototype.getCode=function(){var a;switch(a=this.get("file"),this.getType(a)){case"video":return"^^"+a;case"image":return"![Figure]("+a+")";default:return"[Attachment]("+a+")"}},b.prototype.getType=function(){var a,b;switch(a=null!=(b=this.get("file").match(/\.[^/\.]+$/))?b[0].toLowerCase():void 0){case".ogg":case".mp4":case".webm":return"video";case".jpe":case".jpeg":case".jpg":case".png":case".gif":case".tiff":case".svg":case".bmp":return"image";default:return"unknown"}},b}(e.Model),e.Views.AttachmentItem=function(b){function c(){return i=c.__super__.constructor.apply(this,arguments)}return o(c,b),c.prototype.tagName="div",c.prototype.className="attachment-item",c.prototype.events={"click button.delete":"deleteAttachment"},c.prototype.initialize=function(){return this.clip=new ZeroClipboard,this.listenTo(this.model,"destroy",this.remove)},c.prototype.render=function(){return this.$el.html(_.template(a("#template-attachment-item").html())(this.model.toJSON())),this.$button=this.$("button.copy"),this.enableZeroClipboard(),this},c.prototype.enableZeroClipboard=function(){return this.$button.attr("data-clipboard-text",this.model.getCode()),this.clip.glue(this.$button),this.clip.on("complete",function(b,c){return this&&c.text===a(this).attr("data-clipboard-text")?e.Notification.success("Markdown code has been copied to clipboard."):void 0})},c.prototype.deleteAttachment=function(){return confirm("Are you sure you want to delete "+this.model.get("name"))?this.model.destroy():void 0},c.prototype.remove=function(){return this.clip.unglue(this.$button),c.__super__.remove.call(this)},c}(Backbone.View),e.Views.AttachmentUpload=function(b){function c(){return j=c.__super__.constructor.apply(this,arguments)}return o(c,b),c.prototype.events={"click button.upload":"startUpload"},c.prototype.render=function(){return this.$el.html(_.template(a("#template-attachment-upload").html())),this.$buttonUpload=this.$("button.upload"),this.$dropZone=this.$(".drop-zone"),this.enableFileUpload(),this},c.prototype.getUploader=function(){return this.$(".file-upload")},c.prototype.enableFileUpload=function(){var a=this;return this.getUploader().fileupload({url:this.options.url,dropZone:this.$dropZone,add:function(a,b){return b.formData={csrfmiddlewaretoken:e.Config.CSRFToken},b.submit()},done:function(b,c){return a.trigger("uploaded",new e.Models.AttachmentItem(c.result))}})},c.prototype.startUpload=function(){return this.getUploader().click()},c.prototype.remove=function(){return this.getUploader().fileupload("destroy"),c.__super__.remove.call(this)},c}(Backbone.View),e.Collections.AttachmentList=function(a){function b(){return k=b.__super__.constructor.apply(this,arguments)}return o(b,a),b.prototype.model=e.Models.AttachmentItem,b}(Backbone.Collection),e.Views.AttachmentList=function(b){function c(){return l=c.__super__.constructor.apply(this,arguments)}return o(c,b),c.prototype.initialize=function(){var a,b;return b=this.$el.data("url"),a=this.$el.data("preload"),this.uploader=new e.Views.AttachmentUpload({url:b}),this.collection=new e.Collections.AttachmentList([],{url:b}),this.render(),this.listenTo(this.uploader,"uploaded",this.uploadedAttachment),this.listenTo(this.collection,"add",this.addAttachment),this.listenTo(this.collection,"reset",this.addAttachments),a?this.collection.reset(a):this.collection.fetch({reset:!0})},c.prototype.render=function(){return this.$el.html(_.template(a("#template-attachment-list").html())),this.$collectionElement=this.$(".attachment-collection"),this.$uploaderElement=this.$(".attachment-upload"),this.$uploaderElement.prepend(this.uploader.render().el),this},c.prototype.addAttachment=function(a){var b;return b=new e.Views.AttachmentItem({model:a}),this.$collectionElement.prepend(b.render().el)},c.prototype.addAttachments=function(){var a=this;return this.$collectionElement.empty(),this.collection.each(function(b){return a.addAttachment(b)})},c.prototype.uploadedAttachment=function(a){return this.collection.add(a)},c.prototype.remove=function(){return this.uploader.remove(),c.__super__.remove.call(this)},c}(Backbone.View),a(function(){return a(".attachment-list").each(function(a,b){return new e.Views.AttachmentList({el:b})})}),a=jQuery,b=function(){function b(){this.clip=new ZeroClipboard,this.clip.on("complete",function(b,c){return this&&c.text===a(this).attr("data-clipboard-text")&&a(this).attr("data-clipboard-notification")?e.Notification.success(a(this).attr("data-clipboard-notification")):void 0}),this.enable()}return b.prototype.enable=function(b){return null==b&&(b=a("body")),this.clip.glue(b.find(".clipboard[data-clipboard-text]"))},b}(),a(function(){return new b}),e.Views.EditRoomForm=function(a){function b(){return m=b.__super__.constructor.apply(this,arguments)}return o(b,a),b.prototype.events={'change input[name="is_personal"]':"toggleIsPersonal"},b.prototype.initialize=function(){return this.$isPersonal=this.$('input[name="is_personal"]'),this.toggleIsPersonal()},b.prototype.toggleIsPersonal=function(){return this.$isPersonal.length?this.$isPersonal.prop("checked")?this.$(".personal").show():this.$(".personal").hide():void 0},b}(Backbone.View),a(function(){return a(".edit-room-form").each(function(a,b){return new e.Views.EditRoomForm({el:b})})})}.call(this);

	
